# Vision Assistant Pro — Документация

**Vision Assistant Pro** — это продвинутый, многомодальный ИИ-ассистент для NVDA. Он использует модели Gemini от Google для предоставления возможностей интеллектуального чтения с экрана, перевода, голосового ввода и анализа документов.

_Это дополнение было выпущено для сообщества в честь Международного дня людей с ограниченными возможностями._

## 1. Установка и настройка

Перейдите в **Меню NVDA > Параметры > Настройки > Vision Assistant Pro**.

- **Ключ API:** Обязателен. Можно ввести несколько ключей (разделяя их запятыми или новой строкой). Ассистент будет автоматически переключаться между ними при достижении лимита квоты.
- **Модель ИИ:** Выберите между моделями **Flash** (самая быстрая/бесплатная), **Lite** или **Pro** (высокий интеллект).
- **URL прокси:** Необязательно. Используйте, если Google заблокирован в вашем регионе. Это должен быть веб-адрес, выступающий в качестве моста к API Gemini.
- **Движок OCR:** Выберите между **Chrome (быстро)** для быстрых результатов или **Gemini (форматированный)** для превосходного сохранения разметки и распознавания таблиц.
- **Голос TTS:** Выберите предпочитаемый стиль голоса для создания аудиофайлов из страниц документа.
- **Умная замена (Smart Swap):** Автоматически меняет языки местами, если исходный текст соответствует целевому языку.
- **Прямой вывод (Direct Output):** Пропускает окно чата и сразу озвучивает ответ ИИ через речь.
- **Интеграция с буфером обмена (Clipboard Integration):** Автоматически копирует ответ ИИ в буфер обмена.

## 2. Командный слой и комбинации клавиш

Для предотвращения конфликтов клавиш это дополнение использует **Командный слой (Command Layer)**.
1. Нажмите **NVDA + Shift + V** (главная клавиша), чтобы активировать слой (вы услышите звуковой сигнал).
2. Отпустите клавиши, затем нажмите одну из следующих одиночных клавиш:

| Клавиша         | Функция                      | Описание                                                                 |
|-----------------|------------------------------|-------------------------------------------------------------------------|
| **T**           | Умный переводчик (Smart Translator) | Переводит текст под курсором навигатора или выделение.                 |
| **Shift + T**   | Перевод из буфера обмена (Clipboard Translator) | Переводит содержимое, находящееся в данный момент в буфере обмена.    |
| **R**           | Улучшение текста (Text Refiner) | Суммировать, исправить грамматику, объяснить или запустить **Пользовательские запросы (Custom Prompts)**. |
| **V**           | Распознавание объекта (Object Vision) | Описывает текущий объект навигатора.                                  |
| **O**           | Распознавание всего экрана (Full Screen Vision) | Анализирует всю компоновку и содержимое экрана.                       |
| **Shift + V**   | Анализ онлайн-видео (Online Video Analysis) | Анализирует видео с **YouTube**, **Instagram** или **Twitter (X)** по URL. |
| **D**           | Читатель документов (Document Reader) | Продвинутый читатель для PDF и изображений с выбором диапазона страниц. |
| **F**           | OCR файла (File OCR)         | Прямое распознавание текста из выбранных файлов изображений, PDF или TIFF. |
| **A**           | Аудио транскрипция (Audio Transcription) | Транскрибирует файлы MP3, WAV или OGG в текст.                       |
| **C**           | Решатель CAPTCHA (CAPTCHA Solver) | Захватывает и решает CAPTCH на экране или объекте навигатора.        |
| **S**           | Умный диктант (Smart Dictation) | Преобразует речь в текст. Нажмите, чтобы начать запись, ещё раз — чтобы остановить/ввести. |
| **L**           | Отчёт о состоянии (Status Reporting) | Озвучивает текущий прогресс (например, «Сканирование...», «Ожидание»). |
| **U**           | Проверка обновлений (Update Check) | Вручную проверить GitHub на наличие последней версии дополнения.     |
| **H**           | Справка по командам (Commands Help) | Показывает список всех доступных комбинаций клавиш в командном слое. |

### 2.1 Комбинации клавиш читателя документов (внутри окна просмотра)
После открытия документа командой **D**:
- **Ctrl + PageDown:** Перейти на следующую страницу (озвучивает номер страницы).
- **Ctrl + PageUp:** Перейти на предыдущую страницу (озвучивает номер страницы).
- **Alt + A:** Открыть диалог чата, чтобы задавать вопросы о документе.
- **Alt + R:** Принудительно повторно сканировать текущую страницу или все страницы с использованием движка Gemini.
- **Alt + G:** Сгенерировать и сохранить высококачественный аудиофайл (WAV) из содержимого.
- **Alt + S / Ctrl + S:** Сохранить извлечённый текст как файл TXT или HTML.

## 3. Пользовательские запросы и переменные

Откройте **Настройки > Запросы > Управление запросами...**, чтобы настроить системные и пользовательские запросы.

- **Вкладка «Запросы по умолчанию»:** редактирование встроенных запросов. Можно сбросить один запрос или все настройки по умолчанию.
- **Вкладка «Пользовательские запросы»:** добавление, редактирование, удаление и изменение порядка пользовательских запросов.
- **Кнопка «Руководство по переменным»:** открывает окно справки со всеми поддерживаемыми переменными и типами ввода.

### Доступные переменные

| Переменная       | Описание                                      | Тип ввода         |
|------------------|-----------------------------------------------|-------------------|
| `[selection]`    | Выделенный в данный момент текст             | Текст             |
| `[clipboard]`    | Содержимое буфера обмена                     | Текст             |
| `[screen_obj]`   | Скриншот объекта навигатора                  | Изображение       |
| `[screen_full]`  | Скриншот всего экрана                        | Изображение       |
| `[file_ocr]`     | Выбрать файл изображения/PDF для извлечения текста | Изображение, PDF, TIFF |
| `[file_read]`    | Выбрать документ для чтения                  | TXT, Код, PDF     |
| `[file_audio]`   | Выбрать аудиофайл для анализа                | MP3, WAV, OGG     |

### Примеры пользовательских запросов

- **Быстрый OCR:** `Мой OCR:[file_ocr]`
- **Перевод изображения:** `Перевод изображения: Извлеки текст с этого изображения и переведи на английский. [file_ocr]`
- **Анализ аудио:** `Суммаризация аудио: Прослушайте эту запись и суммируйте основные моменты. [file_audio]`
- **Отладчик кода:** `Отладка: Найдите ошибки в этом коде и объясните их: [selection]`

***
**Примечание:** Для работы всех функций ИИ требуется активное интернет-соединение. Многостраничные документы и TIFF обрабатываются автоматически.
## Изменения в версии 4.5
**Расширенный менеджер запросов:** Представлен специальный диалог управления в настройках для кастомизации системных запросов по умолчанию и управления пользовательскими запросами с полной поддержкой добавления, редактирования, изменения порядка и предварительного просмотра.
**Всесторонняя поддержка прокси:** Устранены проблемы с сетевым подключением за счёт строгого применения настроек прокси, заданных пользователем, ко всем запросам API, включая перевод, OCR и генерацию речи.
**Автоматическая миграция данных:** Интегрирована интеллектуальная система миграции для автоматического обновления устаревших конфигураций запросов до надёжного формата JSON v2 при первом запуске без потери данных.
**Обновлена совместимость (2025.1):** Минимально требуемая версия NVDA установлена на 2025.1 из-за зависимостей библиотек в продвинутых функциях, таких как «Читатель документов», для обеспечения стабильной работы.
**Оптимизированный интерфейс настроек:** Упрощён интерфейс настроек путём реорганизации управления запросами в отдельный диалог, обеспечивая более чистый и доступный пользовательский опыт.
**Руководство по переменным запросов:** Добавлено встроенное руководство в диалогах запросов, чтобы помочь пользователям легко идентифицировать и использовать динамические переменные, такие как `[selection]`, `[clipboard]` и `[screen_obj]`.

## Изменения в версии 4.0.3
*   **Улучшенная устойчивость сети:** Добавлен механизм автоматической повторной попытки для лучшей обработки нестабильных интернет-соединений и временных ошибок сервера, обеспечивая более надёжные ответы ИИ.
*   **Визуальный диалог перевода:** Представлено специальное окно для результатов перевода. Теперь пользователи могут легко перемещаться и читать длинные переводы построчно, аналогично результатам OCR.
*   **Агрегированное форматированное представление:** Функция «Просмотр форматированного» в «Читателе документов» теперь отображает все обработанные страницы в одном организованном окне с чёткими заголовками страниц.
*   **Оптимизированный рабочий процесс OCR:** Автоматически пропускает выбор диапазона страниц для одностраничных документов, делая процесс распознавания быстрее и более плавным.
*   **Улучшена стабильность API:** Переход на более надёжный метод аутентификации на основе заголовков, устраняющий потенциальные ошибки «Все ключи API не сработали», вызванные конфликтами ротации ключей.
*   **Исправления ошибок:** Устранены несколько потенциальных сбоев, включая проблему при завершении работы дополнения и ошибку фокуса в диалоге чата.

## Изменения в версии 4.0.1
*   **Продвинутый читатель документов:** Мощное новое окно просмотра для PDF и изображений с выбором диапазона страниц, фоновой обработкой и плавной навигацией `Ctrl+PageUp/Down`.
*   **Новое подменю «Инструменты»:** Добавлено специальное подменю «Vision Assistant» в меню «Инструменты» NVDA для более быстрого доступа к основным функциям, настройкам и документации.
*   **Гибкая настройка:** Теперь можно выбрать предпочитаемый движок OCR и голос TTS непосредственно из панели настроек.
*   **Поддержка нескольких ключей API:** Добавлена поддержка нескольких ключей API Gemini. Ключи можно вводить по одному на строку или разделять запятыми в настройках.
*   **Альтернативный движок OCR:** Представлен новый движок OCR для обеспечения надёжного распознавания текста даже при достижении лимитов квоты API Gemini.
*   **Умная ротация ключей API:** Автоматически переключается на самый быстрый рабочий ключ API и запоминает его для обхода лимитов квоты.
*   **Документ в MP3/WAV:** Интегрирована возможность генерировать и сохранять высококачественные аудиофайлы в форматах MP3 (128kbps) и WAV непосредственно в читателе.
*   **Поддержка Instagram Stories:** Добавлена возможность описывать и анализировать Instagram Stories с использованием их URL.
*   **Поддержка TikTok:** Представлена поддержка видео TikTok, позволяющая осуществлять полное визуальное описание и аудио транскрипцию клипов.
*   **Переработанный диалог обновления:** Обновлён доступный интерфейс с прокручиваемым текстовым полем для чёткого ознакомления с изменениями версии перед установкой.
*   **Унифицированный статус и UX:** Стандартизированы диалоги выбора файлов в дополнении и улучшена команда «L» для отчёта о прогрессе в реальном времени.

## Изменения в версии 3.6.0
*   **Система справки:** Добавлена команда справки (`H`) в Командном слое для предоставления легко доступного списка всех комбинаций клавиш и их функций.
*   **Анализ онлайн-видео:** Расширена поддержка, включив видео **Twitter (X)**. Также улучшено обнаружение URL и стабильность для более надёжной работы.
*   **Вклад в проект:** Добавлен необязательный диалог пожертвования для пользователей, которые хотят поддержать будущие обновления и постоянное развитие проекта.

## Изменения в версии 3.5.0
*   **Командный слой:** Представлена система Командного слоя (по умолчанию: `NVDA+Shift+V`) для группировки комбинаций клавиш под одной главной клавишей. Например, вместо нажатия `NVDA+Control+Shift+T` для перевода теперь нужно нажать `NVDA+Shift+V`, а затем `T`.
*   **Анализ онлайн-видео:** Добавлена новая функция для анализа видео YouTube и Instagram напрямую путём предоставления URL.

## Изменения в версии 3.1.0
*   **Режим прямого вывода (Direct Output Mode):** Добавлена опция пропустить диалог чата и сразу услышать ответы ИИ через речь для более быстрого и плавного взаимодействия.
*   **Интеграция с буфером обмена (Clipboard Integration):** Добавлена новая настройка для автоматического копирования ответов ИИ в буфер обмена.

## Изменения в версии 3.0

*   **Новые языки:** Добавлены переводы на **персидский** и **вьетнамский**.
*   **Расширенные модели ИИ:** Реорганизован список выбора моделей с чёткими префиксами (`[Бесплатно]`, `[Pro]`, `[Авто]`), чтобы помочь пользователям различать бесплатные и ограниченные квотой (платные) модели. Добавлена поддержка **Gemini 3.0 Pro** и **Gemini 2.0 Flash Lite**.
*   **Стабильность диктовки:** Значительно улучшена стабильность «Умного диктанта». Добавлена проверка безопасности для игнорирования аудиоклипов короче 1 секунды, предотвращая «галлюцинации» ИИ и пустые ошибки.
*   **Обработка файлов:** Исправлена проблема, из-за которой загрузка файлов с именами не на английском языке не удавалась.
*   **Оптимизация запросов:** Улучшена логика перевода и структурированы результаты «Распознавания».

## Изменения в версии 2.9

*   **Добавлены французский и турецкий переводы.**
*   **Форматированный просмотр:** Добавлена кнопка «Просмотр форматированного» в диалогах чата для просмотра разговора с правильным стилем (заголовки, жирный шрифт, код) в стандартном окне с возможностью обзора.
*   **Настройка Markdown:** Добавлена новая опция «Очищать Markdown в чате» в настройках. Снятие этой галочки позволяет пользователям видеть необработанный синтаксис Markdown (например, `**`, `#`) в окне чата.
*   **Управление диалогами:** Исправлена проблема, когда окна «Улучшить текст» или чата открывались несколько раз или не фокусировались правильно.
*   **Улучшения UX:** Стандартизированы заголовки диалогов файлов на «Открыть» и удалены избыточные голосовые объявления (например, «Открывается меню...») для более плавного взаимодействия.

## Изменения в версии 2.8
* Добавлен итальянский перевод.
* **Отчёт о состоянии (Status Reporting):** Добавлена новая команда (NVDA+Control+Shift+I) для озвучивания текущего состояния дополнения (например, «Загрузка...», «Анализ...»).
* **Экспорт HTML:** Кнопка «Сохранить содержимое» в диалогах результатов теперь сохраняет вывод в виде форматированного HTML-файла, сохраняя стили, такие как заголовки и жирный текст.
* **Интерфейс настроек:** Улучшена компоновка панели настроек с доступной группировкой.
* **Новые модели:** Добавлена поддержка `gemini-flash-latest` и `gemini-flash-lite-latest`.
* **Языки:** Добавлен непальский в поддерживаемые языки.
* **Логика меню улучшения:** Исправлена критическая ошибка, из-за которой команды «Улучшить текст» не работали, если язык интерфейса NVDA был не английским.
* **Диктовка:** Улучшено обнаружение тишины для предотвращения некорректного вывода текста, когда речевой ввод отсутствует.
* **Настройки обновления:** Опция «Проверять обновления при запуске» теперь отключена по умолчанию для соответствия политикам Магазина дополнений.
* Очистка кода.

## Изменения в версии 2.7
* Мигрирована структура проекта на официальный шаблон дополнений NV Access для лучшего соответствия стандартам.
* Реализована логика автоматической повторной попытки для ошибок HTTP 429 (ограничение скорости) для обеспечения надёжности при высокой нагрузке.
* Оптимизированы запросы на перевод для повышения точности и улучшения обработки логики «Умной замены».
* Обновлён русский перевод.

## Изменения в версии 2.6
* Добавлена поддержка русского перевода (благодаря nvda-ru).
* Обновлены сообщения об ошибках для предоставления более описательной обратной связи относительно подключения.
* Изменён язык перевода по умолчанию на английский.

## Изменения в версии 2.5
* Добавлена нативная команда OCR файла (NVDA+Control+Shift+F).
* Добавлена кнопка «Сохранить чат» в диалоги результатов.
* Реализована полная поддержка локализации (i18n).
* Мигрированы звуковые уведомления на нативный модуль сигналов NVDA.
* Переход на File API Gemini для лучшей обработки PDF и аудиофайлов.
* Исправлен сбой при переводе текста, содержащего фигурные скобки.

## Изменения в версии 2.1.1
* Исправлена проблема, когда переменная `[file_ocr]` не работала корректно в Пользовательских запросах.

## Изменения в версии 2.1
* Все комбинации клавиш стандартизированы для использования NVDA+Control+Shift, чтобы исключить конфликты с раскладкой ноутбука NVDA и системными горячими клавишами.

## Изменения в версии 2.0
* Реализована встроенная система автоматического обновления.
* Добавлен «Кэш умного перевода» для мгновенного извлечения ранее переведённого текста.
* Добавлена «Память разговора» для контекстного уточнения результатов в диалогах чата.
* Добавлена специальная команда перевода из буфера обмена (NVDA+Control+Shift+Y).
* Оптимизированы запросы ИИ для строгого соблюдения вывода на целевом языке.
* Исправлен сбой, вызванный специальными символами во входном тексте.

## Изменения в версии 1.5
* Добавлена поддержка более 20 новых языков.
* Реализован интерактивный диалог улучшения для уточняющих вопросов.
* Добавлена нативная функция «Умный диктант».
* Добавлена категория «Vision Assistant» в диалог «Жесты ввода» NVDA.
* Исправлены сбои COMError в определённых приложениях, таких как Firefox и Word.
* Добавлен механизм автоматической повторной попытки для ошибок сервера.

## Изменения в версии 1.0
* Первоначальный выпуск.
